use master
CREATE DATABASE QUANLYTHUCHI
GO 
USE QUANLYTHUCHI

--BANG TAI KHOAN
CREATE TABLE TAI_KHOAN (
	ID_TK INT PRIMARY KEY, 
	TEN_TK NVARCHAR(100),
	PASSWORD VARCHAR (50),
	EMAIL VARCHAR(50),
	STD CHAR(11)
);
DROP TABLE TAI_KHOAN 

--BANG DANH MUC
CREATE TABLE DANH_MUC (
	ID_DM INT PRIMARY KEY,
	ID_TK INT,
	ID_LOAIDM INT,
	FOREIGN KEY (ID_TK) REFERENCES TAI_KHOAN(ID_TK),
	FOREIGN KEY (ID_LOAIDM) REFERENCES LOAI_DANHMUC(ID_LOAIDM)
);
DROP TABLE DANH_MUC

--BANG LOAI DANH MUC
CREATE TABLE LOAI_DANHMUC (
    ID_LOAIDM INT PRIMARY KEY ,
    TEN_DM NVARCHAR(100) NOT NULL
);
DROP TABLE LOAI_DANHMUC

--BANG GIAO DICH
CREATE TABLE GIAO_DICH (
    ID_GD INT PRIMARY KEY,
    ID_TK INT,
    ID_DM INT,
	ID_LOAIGD INT,
    SO_TIEN DECIMAL(10, 2) NOT NULL,
    NGAY_GD DATE NOT NULL,
    FOREIGN KEY (ID_TK) REFERENCES TAI_KHOAN(ID_TK),
    FOREIGN KEY (ID_DM) REFERENCES DANH_MUC(ID_DM),
	FOREIGN KEY (ID_LOAIGD) REFERENCES LOAI_GD(ID_LOAIGD)
);
DROP TABLE GIAO_DICH

--BANG LOAI GIAO DICH
CREATE TABLE LOAI_GD (
	ID_LOAIGD INT PRIMARY KEY,
	TEN_GD NVARCHAR(100) NOT NULL
)
DROP TABLE LOAI_GD 


--BANG MUC TIEU
CREATE TABLE MUC_TIEU (
    ID_MT INT PRIMARY KEY ,
    ID_TK INT,
    TEN_MT VARCHAR(100) NOT NULL,
    SOTIEN_MT DECIMAL(10, 2) NOT NULL,
    SOTIEN_TK DECIMAL(10, 2) DEFAULT 0.00,
    NGAY_BD DATE,
    NGAY_KT DATE,
    FOREIGN KEY (ID_TK) REFERENCES TAI_KHOAN(ID_TK)
);

CREATE TABLE THONG_KE (
    ID_TKE INT PRIMARY KEY ,
    ID_TK INT,
    SOTIEN_TK DECIMAL(10, 2) NOT NULL,
    ID_LOAITK INT NOT NULL,
    NGAY_BDTK DATE NOT NULL,
    NGAY_KTTK DATE NOT NULL,
    FOREIGN KEY (ID_TK) REFERENCES TAI_KHOAN(ID_TK),
	FOREIGN KEY (ID_LOAITK) REFERENCES LOAI_TK(ID_LOAITK)
);
DROP TABLE THONG_KE

CREATE TABLE LOAI_TK (
	ID_LOAITK INT PRIMARY KEY,
	TEN_TK NVARCHAR(30),
	)

CREATE TABLE LIEN_KET (
    ID_LK INT PRIMARY KEY ,
    ID_TK INT,
    ID_GD INT,
    QH VARCHAR(50),
    FOREIGN KEY (ID_TK) REFERENCES TAI_KHOAN(ID_TK),
    FOREIGN KEY (ID_GD) REFERENCES GIA_DINH(ID_GD)
);
DROP TABLE LIEN_KET

CREATE TABLE GIA_DINH (
    ID_GD INT PRIMARY KEY,
    TEN_GD VARCHAR(100) NOT NULL
);

INSERT INTO TAI_KHOAN (ID_TK, TEN_TK, PASSWORD, EMAIL, STD) VALUES 
(1, N'Tài Khoản 1', 'password123', 'taikhoan1@example.com', '0123456789'),
(2, N'Tài Khoản 2', 'password456', 'taikhoan2@example.com', '0123456790'),
(3, N'Tài Khoản 3', 'password789', 'taikhoan3@example.com', '0123456701');

INSERT INTO LOAI_DANHMUC (ID_LOAIDM, TEN_DM) VALUES 
(1, N'Ăn uống'),
(2, N'Đi lại'),
(3, N'Giải trí'),
(4, N'Khác');

INSERT INTO DANH_MUC (ID_DM, ID_TK, ID_LOAIDM) VALUES 
(1, 1, 1), -- Tài khoản 1, loại danh mục Ăn uống
(2, 1, 2), -- Tài khoản 1, loại danh mục Đi lại
(3, 2, 3), -- Tài khoản 2, loại danh mục Giải trí
(4, 3, 4); -- Tài khoản 3, loại danh mục Khác

INSERT INTO LOAI_GD (ID_LOAIGD, TEN_GD) VALUES 
(1, N'Thu nhập'),
(2, N'Chi tiêu');

INSERT INTO GIAO_DICH (ID_GD, ID_TK, ID_DM, ID_LOAIGD, SO_TIEN, NGAY_GD) VALUES 
(1, 1, 1, 1, 500000, '2024-10-01'), -- Tài khoản 1, Danh mục 1, Thu nhập
(2, 1, 2, 2, 200000, '2024-10-02'), -- Tài khoản 1, Danh mục 2, Chi tiêu
(3, 2, 3, 1, 300000, '2024-10-03'), -- Tài khoản 2, Danh mục 3, Thu nhập
(4, 3, 4, 2, 150000, '2024-10-04'); -- Tài khoản 3, Danh mục 4, Chi tiêu

INSERT INTO MUC_TIEU (ID_MT, ID_TK, TEN_MT, SOTIEN_MT, SOTIEN_TK, NGAY_BD, NGAY_KT) VALUES 
(1, 1, N'Mục tiêu 1', 1000000, 0.00, '2024-10-01', '2024-10-31'), 
(2, 2, N'Mục tiêu 2', 500000, 0.00, '2024-10-01', '2024-10-31');


INSERT INTO LOAI_TK (ID_LOAITK, TEN_TK) VALUES 
(1, N'Ngày'),
(2, N'Tháng'),
(3, N'Năm');


INSERT INTO THONG_KE (ID_TKE, ID_TK, SOTIEN_TK, ID_LOAITK, NGAY_BDTK, NGAY_KTTK) VALUES 
(1, 1, 500000, 1, '2024-10-01', '2024-10-31'),
(2, 2, 300000, 2, '2024-10-01', '2024-10-31');

INSERT INTO LIEN_KET (ID_LK, ID_TK, ID_GD, QH) VALUES 
(1, 1, 1, N'Bạn bè'),
(2, 2, 2, N'Gia đình');
DELETE FROM LIEN_KET

INSERT INTO GIA_DINH (ID_GD, TEN_GD) VALUES 
(1, N'Gia đình 1'),
(2, N'Gia đình 2');



